<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');

/**
 * LaunchPad for EE
 *
 * @package		Launchpad
 * @subpackage	ThirdParty
 * @category	Modules
 * @author		Bjørn Børresen
 * @link		http://ee.bybjorn.com/launchpad/
 */
class Launchpad_mcp
{
	var $base;			// the base url for this module			
	var $form_base;		// base url for forms
	var $module_name = "launchpad";	

    /**
     * @var Devkit_code_completion
     */
    var $EE;

	function Launchpad_mcp( $switch = TRUE )
	{		
		$this->EE =& get_instance(); 
		$this->base = BASE.AMP.'C=addons_modules'.AMP.'M=show_module_cp'.AMP.'module='.$this->module_name;
		$this->form_base = 'C=addons_modules'.AMP.'M=show_module_cp'.AMP.'module='.$this->module_name;
        $this->EE->load->library('table');
		$this->EE->load->library('javascript');
		$this->EE->load->helper('form');
	}

	function index() 
	{
        $vars = array();

        $q = $this->EE->db->get('snippets');
        foreach($q->result() as $global_variable)
        {
            $vars[$global_variable->snippet_name] = $global_variable->snippet_contents;
        }
        
		return $this->content_wrapper('index', 'welcome', $vars);
	}

    public function save_settings()
    {
        $this->from_post_to_global('launchpad_title');
        $this->from_post_to_global('launchpad_body');
        $this->from_post_to_global('launchpad_rss_feed');
        $this->from_post_to_global('launchpad_use_feedburner_for_mail','n');
        $this->from_post_to_global('launchpad_be_nice','n');

        $this->EE->session->set_flashdata('message_success', lang('settings_saved'));
		$this->EE->functions->redirect($this->base);
    }

    private function from_post_to_global($key, $default=FALSE)
    {
        $value = $this->EE->input->post($key);
        if(!$value)
        {
            $value = $default;
        }
        $this->EE->db->update('snippets', array('snippet_contents'=>$value), array('snippet_name'=>$key, 'site_id' => $this->EE->config->item('site_id')));
    }

	
	function content_wrapper($content_view, $lang_key, $vars = array())
	{
		$vars['content_view'] = $content_view;
		$vars['_base'] = $this->base;
		$vars['_form_base'] = $this->form_base;
		$this->EE->cp->set_variable('cp_page_title', lang($lang_key));
		$this->EE->cp->set_breadcrumb($this->base, lang('launchpad_module_name'));

		return $this->EE->load->view('_wrapper', $vars, TRUE);
	}
}

/* End of file mcp.launchpad.php */ 
/* Location: ./system/expressionengine/third_party/launchpad/mcp.launchpad.php */
/* Generated by DevKit for EE - develop addons faster! */